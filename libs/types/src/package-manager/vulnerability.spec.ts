import { describe, expectTypeOf, it } from "vitest";

import type { Vulnerability } from "./vulnerability";

describe("Vulnerability interface (type-level)", () => {
  it("has a string `package` property", () => {
    expectTypeOf<Vulnerability["package"]>().toEqualTypeOf<string>();
  });

  it("has a `severity` property with the correct union type", () => {
    expectTypeOf<Vulnerability["severity"]>().toEqualTypeOf<"critical" | "high" | "moderate" | "low">();
  });

  it("has a string `description` property", () => {
    expectTypeOf<Vulnerability["description"]>().toEqualTypeOf<string>();
  });

  it("has an optional string `fixAvailable` property", () => {
    expectTypeOf<Vulnerability["fixAvailable"]>().toEqualTypeOf<string | undefined>();
  });

  it("has exactly the expected keys", () => {
    expectTypeOf<keyof Vulnerability>().toEqualTypeOf<"package" | "severity" | "description" | "fixAvailable">();
  });

  it("is assignable from a valid object literal with all properties", () => {
    type Valid = {
      package: string;
      severity: "high";
      description: string;
      fixAvailable: string;
    };

    expectTypeOf<Valid>().toExtend<Vulnerability>();
  });

  it("is assignable from a valid object literal without optional properties", () => {
    type Valid = {
      package: string;
      severity: "critical";
      description: string;
    };

    expectTypeOf<Valid>().toExtend<Vulnerability>();
  });

  it("severity does not accept arbitrary strings", () => {
    expectTypeOf<string>().not.toExtend<Vulnerability["severity"]>();
  });
});
